!function(a,b,c){var d=!1,e={};!function(a,b,c){if(!("console"in a)){var f=a.console={};f.log=f.warn=f.error=f.debug=function(){}}b===e&&(b={fn:{},extend:function(){for(var a=arguments[0],b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)a[e]=d[e]}return a}}),b.fn.pm=function(){return d&&console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])"),this},b.pm=a.bufferpm=function(a){g.send(a)},b.pm.bind=a.bufferpm.bind=function(a,b,c,d){g.bind(a,b,c,d)},b.pm.unbind=a.bufferpm.unbind=function(a,b){g.unbind(a,b)},b.pm.origin=a.bufferpm.origin=null,b.pm.poll=a.bufferpm.poll=200;var g={send:function(a){var c=b.extend({},g.defaults,a),e=c.target;if(!c.target)return void(d&&console.warn("postmessage target window required"));if(!c.type)return void(d&&console.warn("postmessage type required"));var f={data:c.data,type:c.type};c.success&&(f.callback=g._callback(c.success)),c.error&&(f.errback=g._callback(c.error)),"postMessage"in e&&!c.hash?(g._bind(),e.postMessage(JSON.stringify(f),c.origin||"*")):(g.hash._bind(),g.hash.send(c,f))},bind:function(c,d,e,f){"postMessage"in a&&!f?g._bind():g.hash._bind();var h=g.data("listeners.postmessage");h||(h={},g.data("listeners.postmessage",h));var i=h[c];i||(i=[],h[c]=i),i.push({fn:d,origin:e||b.pm.origin})},unbind:function(a,b){var c=g.data("listeners.postmessage");if(c)if(a)if(b){var d=c[a];if(d){for(var e=[],f=0,h=d.length;h>f;f++){var i=d[f];i.fn!==b&&e.push(i)}c[a]=e}}else delete c[a];else for(var f in c)delete c[f]},data:function(a,b){return b===c?g._data[a]:(g._data[a]=b,b)},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var a=[],b=0;32>b;b++)a[b]=g._CHARS[0|32*Math.random()];return a.join("")},_callback:function(a){var b=g.data("callbacks.postmessage");b||(b={},g.data("callbacks.postmessage",b));var c=g._random();return b[c]=a,c},_bind:function(){g.data("listening.postmessage")||(a.addEventListener?a.addEventListener("message",g._dispatch,!1):a.attachEvent&&a.attachEvent("onmessage",g._dispatch),g.data("listening.postmessage",1))},_dispatch:function(a){if(!(a&&a.origin&&a.origin.indexOf("bufferapp")<0)){try{var b=JSON.parse(a.data)}catch(c){return void(d&&console.warn("postmessage data invalid json: ",c))}if(!b.type)return void(d&&console.warn("postmessage message type required"));var e=g.data("callbacks.postmessage")||{},f=e[b.type];if(f)f(b.data);else for(var h=g.data("listeners.postmessage")||{},i=h[b.type]||[],j=0,k=i.length;k>j;j++){var l=i[j];if(l.origin&&a.origin!==l.origin){if(d&&console.warn("postmessage message origin mismatch",a.origin,l.origin),b.errback){var m={message:"postmessage origin mismatch",origin:[a.origin,l.origin]};g.send({target:a.source,data:m,type:b.errback})}}else try{var n=l.fn(b.data);b.callback&&g.send({target:a.source,data:n,type:b.callback})}catch(c){b.errback&&g.send({target:a.source,data:c,type:b.errback})}}}}};g.hash={send:function(b,c){var e=b.target,f=b.url;if(!f)return void(d&&console.warn("postmessage target window url is required"));f=g.hash._url(f);var h,i=g.hash._url(a.location.href);if(a==e.parent)h="parent";else try{for(var j=0,k=parent.frames.length;k>j;j++){var l=parent.frames[j];if(l==a){h=j;break}}}catch(m){h=a.name}if(null==h)return void(d&&console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"));var n={"x-requested-with":"postmessage",source:{name:h,url:i},postmessage:c},o="#x-postmessage-id="+g._random();e.location=f+o+encodeURIComponent(JSON.stringify(n))},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:"#x-postmessage-id=".length+32,_bind:function(){g.data("polling.postmessage")||(setInterval(function(){var b=""+a.location.hash,c=g.hash._regex.exec(b);if(c){var d=c[1];g.hash._last!==d&&(g.hash._last=d,g.hash._dispatch(b.substring(g.hash._regex_len)))}},b.pm.poll||200),g.data("polling.postmessage",1))},_dispatch:function(b){if(b){try{if(b=JSON.parse(decodeURIComponent(b)),!("postmessage"===b["x-requested-with"]&&b.source&&null!=b.source.name&&b.source.url&&b.postmessage))return}catch(c){return}var e=b.postmessage,f=g.data("callbacks.postmessage")||{},h=f[e.type];if(h)h(e.data);else{var i;i="parent"===b.source.name?a.parent:a.frames[b.source.name];for(var j=g.data("listeners.postmessage")||{},k=j[e.type]||[],l=0,m=k.length;m>l;l++){var n=k[l];if(n.origin){var o=/https?\:\/\/[^\/]*/.exec(b.source.url)[0];if(o!==n.origin){if(d&&console.warn("postmessage message origin mismatch",o,n.origin),e.errback){var p={message:"postmessage origin mismatch",origin:[o,n.origin]};g.send({target:i,data:p,type:e.errback,hash:!0,url:b.source.url})}continue}}try{var q=n.fn(e.data);e.callback&&g.send({target:i,data:q,type:e.callback,hash:!0,url:b.source.url})}catch(c){e.errback&&g.send({target:i,data:c,type:e.errback,hash:!0,url:b.source.url})}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}},b.extend(g,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})}(this,"undefined"==typeof jQuery?e:jQuery),b.getElementsByClassName||(b.getElementsByClassName=function(a){if(b.querySelectorAll)return b.querySelectorAll("."+a);var c,d,e,f=[];if(b.evaluate)for(d=".//[contains(concat(' ', @class, ' '), ' "+a+" ')]",c=b.evaluate(d,b,null,0,null);e=c.iterateNext();)f.push(e);else for(c=b.getElementsByTagName("*"),d=new RegExp("(^|\\s)"+a+"(\\s|$)"),e=0;e<c.length;e++)d.test(c[e].className)&&f.push(c[e]);return f});var f=function(a){var c=function(){var b=j.button.endpoint.http;("nocache"===a.local||"cache"===a.local)&&(b=j.button.endpoint.local);for(var c=!0,d=0,e=0,f=j.attributes.length;f>e;e++){var g=j.attributes[e];a[g.name]&&(c&&(b+="?",c=!1),d+=1,d>1&&(b+="&"),b+=g.name+"="+g.encode(a[g.name]))}for(var e=0,f=j.button.attributes.length;f>e;e++){var g=j.button.attributes[e];c&&(b+="?",c=!1),d+=1,d>1&&(b+="&"),b+=g.name+"="+g.get(a)}return b},d=b.createElement("iframe");return d.allowtransparency="true",d.scrolling="no",d.frameBorder="0",d.tabindex="0",d.className="buffer-button",d.style.cssText=j.button.getCSS(a.count),d.src=c(),d},g=function(a){var b=j.overlay.endpoint;a.local&&(b=j.overlay.localendpoint);for(var c=!0,d=0,e=0,f=j.attributes.length;f>e;e++){var g=j.attributes[e];a[g.name]&&(c&&(b+="?",c=!1),d+=1,d>1&&(b+="&"),b+=g.name+"="+g.encode(a[g.name]))}return b},h=function(a,c){var d=b.createElement("iframe");d.allowtransparency="true",d.scrolling="no",d.id="buffer_overlay",d.name="buffer_overlay",d.style.cssText=j.overlay.getCSS(),d.src=g(a),b.body.appendChild(d),bufferpm.bind("buffermessage",function(a){b.body.removeChild(d),bufferpm.unbind("buffermessage"),setTimeout(function(){c(a)},0)})},i=function(b,d){for(var e=c,i={id:d},k=0,l=j.attributes.length;l>k;k++){var m=j.attributes[k];"id"!=m.name&&(i[m.name]=m.get(b.getAttribute("data-"+m.name)))}e=f(i),b.parentNode.appendChild(e);var n=function(a){a.count>0&&bufferpm({target:e.contentWindow,type:"buffer_update",data:a})};return bufferpm.bind("buffer_loaded",function(){setTimeout(function(){bufferpm({target:e.contentWindow,type:"buffer_id",data:{id:d,src:g(i)}}),bufferpm({target:a,type:"buffer_id",data:{id:d}})},0)}),bufferpm.bind("buffer_click_"+d,function(){setTimeout(function(){h(i,n)},0)}),{id:i.id,data:i,element:e}},j={};j.attributes=[{name:"id",get:function(a){return a},encode:function(a){return a}},{name:"url",get:function(b){return!b||b.length<1?a.location.href:b},encode:function(a){return encodeURIComponent(a)}},{name:"text",get:function(a){return!a||a.toString().length<1?b.title:a},encode:function(a){return encodeURIComponent(a)}},{name:"via",get:function(a){return a},encode:function(a){return a}},{name:"count",get:function(a){return!a||a.length<1?"vertical":"vertical"!==a&&"horizontal"!==a?"none":a},encode:function(a){return a}},{name:"picture",get:function(a){return a},encode:function(a){return encodeURIComponent(a)}},{name:"local",get:function(a){return"nocache"===a||"cache"===a?a:!1},encode:function(a){return"nocache"===a?a+"&fresh=true":a}},{name:"placement",get:function(){return"button"},encode:function(a){return encodeURIComponent(a)}}],j.button={endpoint:{http:b.location.protocol+"//widgets.bufferapp.com/button/",local:"http://local.widgets.bufferapp.com/button/"},style:"border: none;",getCSS:function(a){return this.style+"width:"+this[a].width+"px;height:"+this[a].height+"px;"},vertical:{width:55,height:62},horizontal:{width:110,height:20},none:{width:55,height:20},attributes:[{name:"utm_source",get:function(){return encodeURIComponent(a.location.href)}},{name:"utm_medium",get:function(){return"buffer_button"}},{name:"utm_campaign",get:function(){return"buffer"}}]},j.overlay={endpoint:b.location.protocol+"//bufferapp.com/add/",localendpoint:b.location.protocol+"//local.bufferapp.com/add/",getCSS:function(){return"border:none;height:100%;width:100%;position:fixed;z-index:99999999;top:0;left:0;"}};for(var k=[],l=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},m=function(){return l()+l()+l()+l()},n=b.getElementsByClassName("buffer-add-button"),o=0,p=0,q=n.length;q>p;p++)o+=1,k.push(i(n[p],m()));for(var p=0;o>p;p++){var r=n[0];r.parentNode.removeChild(r)}}(window,document);
//# sourceMappingURL=button.js.map